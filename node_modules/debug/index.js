// path/to/module/debug.js

var express = require('express');

exports.diagnostics = function() {    
    var app1 = express.createServer();
    
    app1.configure(function() {
        this.set('view engine', 'ejs');
        this.set('views', __dirname + '/views');
        this.set('view options', { layout: false, open: '{%', close: '%}' });
    });
    
    app1.mounted(function(host) {
        host.dynamicHelpers({
            app1inc: function(req, res) {
                return function(ctx) {
                    // XXX res.app is app1, so this fails...
                    // the intention is that the app we're mounted in
                    // should get the content from our bundled include
                    return res.partial('_include.ejs', { object: ctx, as: 'foo' });
                }
            }
        });
    });
    
    app1.get('/', function(req, res) { res.render('index.ejs'); });
    
    return app1;
};

